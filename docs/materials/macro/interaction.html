<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R for Political Science – 第12回講義資料</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Figs/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9TLN2VMPQD"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-9TLN2VMPQD', { 'anonymize_ip': true});
</script>
<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&amp;display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono&amp;display=swap" rel="stylesheet"> 

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../Figs/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">R for Political Science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">シラバス</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-">    
        <li>
    <a class="dropdown-item" href="../../syllabus/syllabus_micro.html">
 <span class="dropdown-text">[前期] ミクロ政治データ分析実習</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../syllabus/syllabus_macro.html">
 <span class="dropdown-text">[後期] マクロ政治データ分析実習</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../syllabus/session.html">
 <span class="dropdown-text">セッション情報</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rの使い方" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Rの使い方</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-rの使い方">    
        <li>
    <a class="dropdown-item" href="../../intro/install.html">
 <span class="dropdown-text">Rの導入</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/rstudio.html">
 <span class="dropdown-text">RStudioの設定</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/filesystem.html">
 <span class="dropdown-text">ファイル・システム</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/project.html">
 <span class="dropdown-text">プロジェクト管理</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/file.html">
 <span class="dropdown-text">ファイル管理</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/packages.html">
 <span class="dropdown-text">パッケージ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/homework.html">
 <span class="dropdown-text">課題の取り組み方</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/faq.html">
 <span class="dropdown-text">この授業の「あるある」</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu--1" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">前期講義資料</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu--1">    
        <li>
    <a class="dropdown-item" href="../../materials/micro/introduction.html">
 <span class="dropdown-text">第1回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/r.html">
 <span class="dropdown-text">第2回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/basic.html">
 <span class="dropdown-text">第3回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/programming.html">
 <span class="dropdown-text">第4回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/quarto.html">
 <span class="dropdown-text">第5回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/dataset.html">
 <span class="dropdown-text">第6回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/datatype.html">
 <span class="dropdown-text">第7回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/datastructure.html">
 <span class="dropdown-text">第8回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/handling1.html">
 <span class="dropdown-text">第9回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/handling2.html">
 <span class="dropdown-text">第10回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/handling3.html">
 <span class="dropdown-text">第11回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/visualization1.html">
 <span class="dropdown-text">第12回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/visualization2.html">
 <span class="dropdown-text">第13回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/visualization3.html">
 <span class="dropdown-text">第14回講義資料</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu--2" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">後期講義資料</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu--2">    
        <li>
    <a class="dropdown-item" href="../../materials/macro/introduction.html">
 <span class="dropdown-text">第1回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/research_design.html">
 <span class="dropdown-text">第2・3回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/descriptive_statistics.html">
 <span class="dropdown-text">第4回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/inference.html">
 <span class="dropdown-text">第5回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/nhts.html">
 <span class="dropdown-text">第6回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/association.html">
 <span class="dropdown-text">第7回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/regression1.html">
 <span class="dropdown-text">第8回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/regression2.html">
 <span class="dropdown-text">第9回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/reporting.html">
 <span class="dropdown-text">第10回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/logit.html">
 <span class="dropdown-text">第11回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/interaction.html">
 <span class="dropdown-text">第12回講義資料</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu--3" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">課題</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu--3">    
        <li>
    <a class="dropdown-item" href="../../intro/homework.html">
 <span class="dropdown-text">課題の取り組み方</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">ミクロ</li>
        <li>
    <a class="dropdown-item" href="../../HW/Micro_HW05.html">
 <span class="dropdown-text">[前期] 第5回課題</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HW/Micro_HW10.html">
 <span class="dropdown-text">[前期] 第10回課題</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HW/Micro_HW11.html">
 <span class="dropdown-text">[前期] 第11回課題</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HW/Micro_Final.html">
 <span class="dropdown-text">[前期] 期末レポート</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">マクロ</li>
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://jupyter.cs.rcos.nii.ac.jp/"> <i class="bi bi-terminal" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.jaysong.net/RBook/"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../materials/macro/interaction.html">第12回講義資料</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">第1回講義資料</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/research_design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">第2・3回講義資料</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/descriptive_statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">第4回講義資料</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">第5回講義資料</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/nhts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">第6回講義資料</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/association.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">第7回講義資料</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/regression1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">第8回講義資料</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/regression2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">第9回講義資料</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/reporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">第10回講義資料</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/logit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">第11回講義資料</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/interaction.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">第12回講義資料</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#セットアップ" id="toc-セットアップ" class="nav-link active" data-scroll-target="#セットアップ">セットアップ</a></li>
  <li><a href="#交互作用とは" id="toc-交互作用とは" class="nav-link" data-scroll-target="#交互作用とは">交互作用とは</a></li>
  <li><a href="#推定" id="toc-推定" class="nav-link" data-scroll-target="#推定">推定</a>
  <ul class="collapse">
  <li><a href="#モデル1の解釈" id="toc-モデル1の解釈" class="nav-link" data-scroll-target="#モデル1の解釈">モデル1の解釈</a></li>
  <li><a href="#モデル2の解釈" id="toc-モデル2の解釈" class="nav-link" data-scroll-target="#モデル2の解釈">モデル2の解釈</a></li>
  </ul></li>
  <li><a href="#限界効果の話" id="toc-限界効果の話" class="nav-link" data-scroll-target="#限界効果の話">限界効果の話</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">第12回講義資料</h1>
<p class="subtitle lead">交互作用</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="スライド" class="level2 unlisted">
<h2 class="unlisted anchored" data-anchor-id="スライド">スライド</h2>
<p><a href="../../slides/macro/interaction.html" class="btn btn-primary btn-sm" target="_blank" role="button"><i class="bi bi-window"></i> 新しいタブで開く</a></p>
<iframe class="slide-deck" src="../../slides/macro/interaction.html" width="100%" style="aspect-ratio: 16 / 9.2;"></iframe>
</section>
<section id="セットアップ" class="level2">
<h2 class="anchored" data-anchor-id="セットアップ">セットアップ</h2>
<p>　本日の実習用データ（LMSからダウンロード可能）と必要なパッケージ（{tidyverse}、{summarytools}、{marginaleffects}）を読み込む。ただし、{marginaleffects}がインストールされていない場合は、コンソール上に<code>install.packages("marginaleffects")</code>を入力し、インストールしておくこと。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 01</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(summarytools)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>jes_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/JES6_W1_2.csv"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="交互作用とは" class="level2">
<h2 class="anchored" data-anchor-id="交互作用とは">交互作用とは</h2>
<p>　以下の図のように主な説明変数（<span class="math inline">\(X\)</span>）と応答変数（<span class="math inline">\(Y\)</span>）の関係において、<span class="math inline">\(X\)</span>が<span class="math inline">\(Y\)</span>に与える影響がその他の変数（<span class="math inline">\(Z\)</span>）の影響を受ける場合を考えてみよう。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Figs/12/01.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<p>　これは<span class="math inline">\(X\)</span>が<span class="math inline">\(Y\)</span>に与える影響は一定ではないことを意味する（= <span class="math inline">\(X\)</span>が<span class="math inline">\(Y\)</span>に与える影響は<span class="math inline">\(Z\)</span>に依存する）。ここで、<span class="math inline">\(Z\)</span>は<strong>調整変数</strong> (moderation variable; moderator)と呼ばれる。調整変数はダミー変数でも、連続変数でも可能だ。</p>
<p>　この交互作用を実際の回帰式として表すと以下のようになる。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Figs/12/02.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<p><span id="eq-01"><span class="math display">\[
\hat{Y} = \alpha + \beta_1 X + \beta_2 Z + \beta_3 X \cdot Z
\tag{1}\]</span></span></p>
<p>　ここで説明変数に調整変数をかけた変数（<span class="math inline">\(X \cdot Z\)</span>）は<strong>交差項</strong> (interaction term)と呼ばれる。これまでの（重）回帰分析では変数<span class="math inline">\(X\)</span>が<span class="math inline">\(Y\)</span>に与える効果は<span class="math inline">\(\beta_1\)</span>であると解説したが、回帰式に交差項が含まれている場合は解釈に注意が必要だ。なぜなら回帰式において<span class="math inline">\(X\)</span>は<span class="math inline">\(\beta_3\)</span>にも登場するからである。これは <a href="#eq-01" class="quarto-xref">式&nbsp;1</a> を変形してみると分かりやすい。</p>
<p><span id="eq-02"><span class="math display">\[
\hat{Y} = \alpha + (\beta_1 + \beta_3 Z) X + \beta_2 Z
\tag{2}\]</span></span></p>
<p>　<a href="#eq-02" class="quarto-xref">式&nbsp;2</a> によると、変数<span class="math inline">\(X\)</span>が<span class="math inline">\(Y\)</span>に与える効果、つまり<span class="math inline">\(X\)</span>の傾き係数は<span class="math inline">\(\beta_1\)</span>でなく、<span class="math inline">\(\beta_1 + \beta_3 Z\)</span>だということが分かる。交互作用を仮定したモデルに解釈はやや面倒ではないが、難しい数式が登場するわけではない。ここでは調整変数がダミー変数の場合と連続変数の場合の例を紹介する。</p>
<p>　まず、調整変数<span class="math inline">\(Z\)</span>が0、または1の値のみをとるダミー変数の場合（<span class="math inline">\(Z \in \{0, 1\}\)</span>）だ。回帰分析の結果、以下のような1次関数が得られたとしよう。</p>
<p><span id="eq-03"><span class="math display">\[
\begin{align}
\hat{Y} &amp; = 3 + 2 X + 1 Z + 3 X \cdot Z \\
&amp; = 3 + (2 + 3Z) X + 1 Z
\end{align}
\tag{3}\]</span></span></p>
<p>　解釈する場合は<span class="math inline">\(Z = 0\)</span>の場合と<span class="math inline">\(Z = 1\)</span>の場合に分けて解釈する。まず、<span class="math inline">\(Z = 0\)</span>の場合、<span class="math inline">\(\hat{Y} = 3 + (2 + 3\cdot0) X + 1 Z = 3 + 2X + 1Z\)</span>となり、<span class="math inline">\(X\)</span>が<span class="math inline">\(Y\)</span>に与える影響は2となる。一方、<span class="math inline">\(Z = 1\)</span>の場合は<span class="math inline">\(\hat{Y} = 3 + (2 + 3\cdot1) X + 1 Z = 3 + 5X + 1Z\)</span>となり、<span class="math inline">\(X\)</span>が<span class="math inline">\(Y\)</span>に与える影響は5となる。これを可視化すると以下のようになる。</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interaction_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="600"></p>
</figure>
</div>
</div>
</div>
<p>　調整変数<span class="math inline">\(Z\)</span>が0になると傾きが2の回帰直線（赤）が、1になると傾きが5の回帰直線（青）が得られる。</p>
<p>　続いて、調整変数<span class="math inline">\(Z\)</span>が無数の値をとる連続変数の場合を考えてみよう。回帰分析の結果、以下のような1次関数が得られたとしよう。</p>
<p><span id="eq-04"><span class="math display">\[
\begin{align}
\hat{Y} &amp; = 2 + 3 X + 2 Z - 1 X \cdot Z \\
&amp; = 2 + (3 - 1Z) X + 2 Z
\end{align}
\tag{4}\]</span></span></p>
<p>　ここで<span class="math inline">\(Z = -1\)</span>の場合、<span class="math inline">\(\hat{Y} = 2 + (3 - 1\cdot(-1)) X + 2 Z = 3 + 4X + 1Z\)</span>となり、<span class="math inline">\(X\)</span>が<span class="math inline">\(Y\)</span>に与える影響は4となる。また、<span class="math inline">\(Z = 2\)</span>の場合は<span class="math inline">\(\hat{Y} = 2 + (3 - 1\cdot2) X + 2 Z = 3 + 1X + 1Z\)</span>となり、<span class="math inline">\(X\)</span>が<span class="math inline">\(Y\)</span>に与える影響は1となる。<span class="math inline">\(Z\)</span>が3.5の場合は<span class="math inline">\(\hat{Y} = 2 + (3 - 1\cdot3.5) X + 2 Z = 3 - 0.5X + 1Z\)</span>となり、<span class="math inline">\(X\)</span>が<span class="math inline">\(Y\)</span>に与える影響は-0.5となる。これを可視化すると以下のようになる。</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interaction_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="600"></p>
</figure>
</div>
</div>
</div>
<p>　ただし、調整変数が連続変数の場合は、-1、2、3.5以外の値を取ることもできる。<span class="math inline">\(Z\)</span>が取り得るすべての値に対して回帰直線を計算することは出来ないため、いくつかの代表的な値に絞って計算する必要があろう。</p>
</section>
<section id="推定" class="level2">
<h2 class="anchored" data-anchor-id="推定">推定</h2>
<p>　それでは実際に推定してみよう。まず、実習データの中身を確認してみる。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 02</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>jes_df</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,000 × 6
   TempKyosan Female   Age Satisfaction Interest Ideology
        &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1         20      1    69            4        4        9
 2         20      1    47            1        1        7
 3          0      1    37            3        3       11
 4          0      0    51            4        3       11
 5         20      0    38            2        3        7
 6          0      0    71            5        4       11
 7         10      0    47            3        3        9
 8          0      0    71            4        4       11
 9         25      0    75            3        4        9
10         40      1    66            2        3        6
# ℹ 2,990 more rows</code></pre>
</div>
</div>
<p>　各変数の説明は以下の通りだ。</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">変数</th>
<th style="text-align: left;">説明</th>
<th style="text-align: left;">備考</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>TempKyosan</code></td>
<td style="text-align: left;">日本共産党に対する感情温度</td>
<td style="text-align: left;">高いほど好感</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Female</code></td>
<td style="text-align: left;">女性ダミー</td>
<td style="text-align: left;">0: 男性 / 1: 女性</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Age</code></td>
<td style="text-align: left;">回答者の年齢</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Satisfaction</code></td>
<td style="text-align: left;">政治満足度</td>
<td style="text-align: left;">高いほど満足</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Interest</code></td>
<td style="text-align: left;">回答者の政治関心</td>
<td style="text-align: left;">高いほど関心あり</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Ideology</code></td>
<td style="text-align: left;">回答者のイデオロギー</td>
<td style="text-align: left;">高いほど保守的</td>
</tr>
</tbody>
</table>
<p>　データ分析の前に<code>jes_df</code>の記述統計量を確認する。今回のデータはすべて連続変数扱いとなるため、前処理は不要だ。性別は名目変数であるが、既にダミー変数に変換済みである。ダミー変数の記述統計量は連続変数と同じ扱いで問題ないため、データをそのまま{summarytools}パッケージの<code>descr()</code>関数に渡せば良い。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 03</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>jes_df <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">descr</span>(<span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"n.valid"</span>),</span>
<span id="cb4-3"><a href="#cb4-3"></a>        <span class="at">transpose =</span> <span class="cn">TRUE</span>, <span class="at">order =</span> <span class="st">"p"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Descriptive Statistics  
jes_df  
N: 3000  

                      Mean   Std.Dev     Min      Max   N.Valid
------------------ ------- --------- ------- -------- ---------
        TempKyosan   26.88     24.95    0.00   100.00   3000.00
            Female    0.50      0.50    0.00     1.00   3000.00
               Age   47.34     15.63   18.00    75.00   3000.00
      Satisfaction    2.45      1.08    1.00     5.00   3000.00
          Interest    2.74      0.83    1.00     4.00   3000.00
          Ideology    6.34      2.10    1.00    11.00   3000.00</code></pre>
</div>
</div>
<p>　このデータを用い、以下の問いに答えるとする。</p>
<blockquote class="blockquote">
<p>　政治満足度が共産党に対する感情温度に与える影響を調べたい。ただし、この影響は一定ではなく、性別や年齢によって異なるかも知れない。政治満足度が共産党に対する感情温度に与える影響の不均一性を調べるためにはどうすれば良いだろうか。仮説検定に使用する有意水準は5%とする（<span class="math inline">\(\alpha = 0.05\)</span>）。</p>
</blockquote>
<p>　この問いにおける応答変数は「共産党に対する感情温度（<code>TempKyosan</code>）」、主な説明変数は「政治満足度（<code>Satisfaction</code>）」だ。ただし、政治満足度が共産感情温度に与える影響は性別（<code>Female</code>）や年齢（<code>Age</code>）に依存する可能性がある。調整変数が2つであるため、ここでは2つのモデルを作成する。</p>
<p><strong>モデル1</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">種類</th>
<th style="text-align: left;">変数</th>
<th style="text-align: left;">変数名</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">主な説明変数</td>
<td style="text-align: left;">政治満足度</td>
<td style="text-align: left;"><code>Satisfaction</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">応答変数</td>
<td style="text-align: left;">共産党に対する感情温度</td>
<td style="text-align: left;"><code>TempKoysan</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">調整変数</td>
<td style="text-align: left;"><strong>女性ダミー</strong></td>
<td style="text-align: left;"><code>Female</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">統制変数</td>
<td style="text-align: left;">政治関心、イデオロギー、年齢</td>
<td style="text-align: left;"><code>Interest</code>、<code>Ideology</code>、<code>Age</code></td>
</tr>
</tbody>
</table>
<p><strong>モデル2</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">種類</th>
<th style="text-align: left;">変数</th>
<th style="text-align: left;">変数名</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">主な説明変数</td>
<td style="text-align: left;">政治満足度</td>
<td style="text-align: left;"><code>Satisfaction</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">応答変数</td>
<td style="text-align: left;">共産党に対する感情温度</td>
<td style="text-align: left;"><code>TempKoysan</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">調整変数</td>
<td style="text-align: left;"><strong>年齢</strong></td>
<td style="text-align: left;"><code>Age</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">統制変数</td>
<td style="text-align: left;">政治関心、イデオロギー、女性ダミー</td>
<td style="text-align: left;"><code>Interest</code>、<code>Ideology</code>、<code>Female</code></td>
</tr>
</tbody>
</table>
<p>　モデル1は政治満足度（= <strong>説明変数</strong>）が共産党に対する感情温度（= <strong>応答変数</strong>）に与える影響は性別（= <strong>調整変数</strong>）に依存することを意味し、以下のような図として表現できる。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Figs/12/03.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<p>　これを回帰式にする場合、 <a href="#eq-05" class="quarto-xref">式&nbsp;5</a> のような1次関数になる（以下の図参照）。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Figs/12/04.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<p><span id="eq-05"><span class="math display">\[
\widehat{\mbox{TempKyosan}} = \alpha + \beta_1 \mbox{Satisfaction} + \beta_2 \mbox{Female} + \beta_3 \mbox{Interest} + \beta_4 \mbox{Ideology} + \beta_5 \mbox{Age} + \beta_6 (\mbox{Satisfaction} \cdot \mbox{Female})
\tag{5}\]</span></span></p>
<p>　つづいて、モデル2は政治満足度（= <strong>説明変数</strong>）が共産党に対する感情温度（= <strong>応答変数</strong>）に与える影響は年齢（= <strong>調整変数</strong>）に依存することを意味し以下のような図として表現できる。</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Figs/12/05.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<p>　これを回帰式にする場合、 <a href="#eq-06" class="quarto-xref">式&nbsp;6</a> のような1次関数になる（以下の図参照）。</p>
<p><span id="eq-06"><span class="math display">\[
\widehat{\mbox{TempKyosan}} = \alpha + \beta_1 \mbox{Satisfaction} + \beta_2 \mbox{Age} + \beta_3 \mbox{Interest} + \beta_4 \mbox{Ideology} + \beta_5 \mbox{Female} + \beta_6 (\mbox{Satisfaction} \cdot \mbox{Age})
\tag{6}\]</span></span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Figs/12/06.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<p>　推定にはこれまでと同様、<code>lm()</code>関数を使用する。注意するところは第1引数である回帰式（formula）であり、交互作用が存在すると考えられる2つの変数を<code>+</code>でなく、<code>*</code>でつなぐだけだ。ここで<code>A * B</code>の意味は<code>A</code><span class="math inline">\(\times\)</span><code>b</code>だけでなく、<code>A</code>、<code>B</code>、<code>A</code><span class="math inline">\(\times\)</span><code>B</code>が同時に投入することを意味する。</p>
<p>　モデル1と2をそれぞれ<code>fit1</code>、<code>fit2</code>に格納する。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 04</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(TempKyosan <span class="sc">~</span> Satisfaction <span class="sc">*</span> Female <span class="sc">+</span> Interest <span class="sc">+</span> Ideology <span class="sc">+</span> Age, </span>
<span id="cb6-2"><a href="#cb6-2"></a>           <span class="at">data =</span> jes_df)</span>
<span id="cb6-3"><a href="#cb6-3"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(TempKyosan <span class="sc">~</span> Satisfaction <span class="sc">*</span> Age <span class="sc">+</span> Interest <span class="sc">+</span> Ideology <span class="sc">+</span> Female <span class="sc">+</span> Age, </span>
<span id="cb6-4"><a href="#cb6-4"></a>           <span class="at">data =</span> jes_df)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>　2つのモデルの推定結果を横に並べるために{modelsummary}と<code>modelsummary()</code>関数を使用する。2つのモデルオブジェクトは<code>list()</code>関数でまとめることを忘れずに。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 05</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(fit1, fit2),</span>
<span id="cb7-2"><a href="#cb7-2"></a>             <span class="at">statistic =</span> <span class="st">"({p.value})"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;(1)</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;&nbsp;(2)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">49.275</td>
<td style="text-align: center;">28.250</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(&lt;0.001)</td>
<td style="text-align: center;">(&lt;0.001)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Satisfaction</td>
<td style="text-align: center;">−4.732</td>
<td style="text-align: center;">3.308</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(&lt;0.001)</td>
<td style="text-align: center;">(0.015)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Female</td>
<td style="text-align: center;">2.752</td>
<td style="text-align: center;">5.061</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.208)</td>
<td style="text-align: center;">(&lt;0.001)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Interest</td>
<td style="text-align: center;">0.217</td>
<td style="text-align: center;">−0.118</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.703)</td>
<td style="text-align: center;">(0.836)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ideology</td>
<td style="text-align: center;">−1.887</td>
<td style="text-align: center;">−1.690</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(&lt;0.001)</td>
<td style="text-align: center;">(&lt;0.001)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age</td>
<td style="text-align: center;">−0.040</td>
<td style="text-align: center;">0.357</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.178)</td>
<td style="text-align: center;">(&lt;0.001)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Satisfaction × Female</td>
<td style="text-align: center;">0.902</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.270)</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Satisfaction × Age</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">−0.157</td>
</tr>
<tr class="even">
<td style="text-align: left; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;"></td>
<td style="text-align: center; box-shadow: 0px 1.5px;">(&lt;0.001)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Num.Obs.</td>
<td style="text-align: center;">3000</td>
<td style="text-align: center;">3000</td>
</tr>
<tr class="even">
<td style="text-align: left;">R2</td>
<td style="text-align: center;">0.086</td>
<td style="text-align: center;">0.096</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2 Adj.</td>
<td style="text-align: center;">0.084</td>
<td style="text-align: center;">0.094</td>
</tr>
<tr class="even">
<td style="text-align: left;">AIC</td>
<td style="text-align: center;">27560.1</td>
<td style="text-align: center;">27526.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BIC</td>
<td style="text-align: center;">27608.1</td>
<td style="text-align: center;">27574.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Log.Lik.</td>
<td style="text-align: center;">−13772.027</td>
<td style="text-align: center;">−13755.176</td>
</tr>
<tr class="odd">
<td style="text-align: left;">F</td>
<td style="text-align: center;">46.763</td>
<td style="text-align: center;">52.927</td>
</tr>
<tr class="even">
<td style="text-align: left;">RMSE</td>
<td style="text-align: center;">23.85</td>
<td style="text-align: center;">23.72</td>
</tr>
</tbody>
</table>


</div>
</div>
<section id="モデル1の解釈" class="level3">
<h3 class="anchored" data-anchor-id="モデル1の解釈">モデル1の解釈</h3>
<p>　モデル1（<code>fit1</code>）から得られた回帰式は以下の通りである。</p>
<p>共産に対する感情温度の予測値 = 49.28 - 4.73 <span class="math inline">\(\times\)</span> <strong>政治満足度</strong> + 2.75 <span class="math inline">\(\times\)</span> 女性ダミー + 0.22 <span class="math inline">\(\times\)</span> 政治関心 - 1.89 <span class="math inline">\(\times\)</span> イデオロギー - 0.04 <span class="math inline">\(\times\)</span> 年齢 + 0.90 <span class="math inline">\(\times\)</span> <strong>政治満足度</strong> <span class="math inline">\(\times\)</span> 女性ダミー</p>
<p>　これを政治満足度でまとめると、</p>
<p>共産に対する感情温度の予測値 = 49.28 - (4.73 - 0.90 <span class="math inline">\(\times\)</span> 女性ダミー) <span class="math inline">\(\times\)</span> <strong>政治満足度</strong> + 2.75 <span class="math inline">\(\times\)</span> 女性ダミー + 0.22 <span class="math inline">\(\times\)</span> 政治関心 - 1.89 <span class="math inline">\(\times\)</span> イデオロギー - 0.04 <span class="math inline">\(\times\)</span> 年齢</p>
<p>になる。つまり、政治満足度が共産感情温度に与える影響は「-(4.73 - 0.90 <span class="math inline">\(\times\)</span> 女性ダミーの値)」だ。女性ダミーが取り得る値は0（男性）か1（女性）しかないので、ここでは2つのケースにおける政治満足度が共産感情温度に与える影響を計算してみよう。</p>
<p>　まず、男性の場合（<code>Female</code>の値 = 0）、政治満足度が共産感情温度に与える影響は約-4.73（= -(4.73 - 0.90 <span class="math inline">\(\times\)</span> 0) ）である。これは男性の場合、政治満足度が上がると共産感情温度が下がることを意味し、具体的には「男性の場合、政治満足度が1単位上がると、共産に対する感情温度は約4.73度下がる」と解釈できる。また、女性の場合（<code>Female</code>の値 = 1）、政治満足度が共産感情温度に与える影響は約-3.83（= -(4.73 - 0.90 <span class="math inline">\(\times\)</span> 1) ）である。これもまた、女性の場合、政治満足度が上がると共産感情温度が下がることを意味し、具体的には「女性の場合、政治満足度が1単位上がると、共産に対する感情温度は約3.83度下がる」と解釈できる。</p>
<p>　以上の結果を可視化してみよう。まず、{marginaleffects}パッケージの<code>predictions()</code>関数で予測値を計算する。今回は<code>Satisfaction</code>と<code>Female</code>が取りうるすべての組み合わせに応じて予測値を計算する必要がある。つまり、<code>datagrid()</code>内には主な説明変数（<code>Satisfaction</code>）だけでなく、調整変数（<code>Female</code>）の値も指定する必要がある。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 06</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>fit1_pred <span class="ot">&lt;-</span> <span class="fu">predictions</span>(fit1, <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">Satisfaction =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, </span>
<span id="cb8-2"><a href="#cb8-2"></a>                                                  <span class="at">Female       =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>))</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a>fit1_pred</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Satisfaction Female Estimate Std. Error     z Pr(&gt;|z|)     S 2.5 % 97.5 % Interest Ideology  Age
            1      0     31.3      1.048 29.85   &lt;0.001 647.8 29.22   33.3     2.74     6.34 47.3
            1      1     34.9      1.057 33.05   &lt;0.001 793.3 32.85   37.0     2.74     6.34 47.3
            2      0     26.5      0.685 38.75   &lt;0.001   Inf 25.20   27.9     2.74     6.34 47.3
            2      1     31.1      0.668 46.55   &lt;0.001   Inf 29.78   32.4     2.74     6.34 47.3
            3      0     21.8      0.686 31.78   &lt;0.001 733.8 20.46   23.2     2.74     6.34 47.3
            3      1     27.3      0.723 37.72   &lt;0.001   Inf 25.85   28.7     2.74     6.34 47.3
            4      0     17.1      1.050 16.26   &lt;0.001 195.1 15.02   19.1     2.74     6.34 47.3
            4      1     23.4      1.160 20.20   &lt;0.001 299.1 21.16   25.7     2.74     6.34 47.3
            5      0     12.3      1.538  8.03   &lt;0.001  49.8  9.33   15.4     2.74     6.34 47.3
            5      1     19.6      1.707 11.48   &lt;0.001  99.0 16.26   22.9     2.74     6.34 47.3

Columns: rowid, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, TempKyosan, Interest, Ideology, Age, Satisfaction, Female 
Type:  response </code></pre>
</div>
</div>
<p>　続いて、<code>fit1_pred</code>の<code>Female</code>列を修正しよう。0/1だと読者側から見れば読みにくいので、<code>Female</code>列の値が1であれば「女性」、その他の場合は「男性」にリコーディングしよう。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 07</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>fit1_pred <span class="ot">&lt;-</span> fit1_pred <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">mutate</span>(<span class="at">Female =</span> <span class="fu">if_else</span>(Female <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"女性"</span>, <span class="st">"男性"</span>)) </span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a>fit1_pred</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Estimate Std. Error     z Pr(&gt;|z|)     S CI low CI high
     31.3      1.048 29.85   &lt;0.001 647.8  29.22    33.3
     34.9      1.057 33.05   &lt;0.001 793.3  32.85    37.0
     26.5      0.685 38.75   &lt;0.001   Inf  25.20    27.9
     31.1      0.668 46.55   &lt;0.001   Inf  29.78    32.4
     21.8      0.686 31.78   &lt;0.001 733.8  20.46    23.2
     27.3      0.723 37.72   &lt;0.001   Inf  25.85    28.7
     17.1      1.050 16.26   &lt;0.001 195.1  15.02    19.1
     23.4      1.160 20.20   &lt;0.001 299.1  21.16    25.7
     12.3      1.538  8.03   &lt;0.001  49.8   9.33    15.4
     19.6      1.707 11.48   &lt;0.001  99.0  16.26    22.9

Columns: rowid, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, TempKyosan, Interest, Ideology, Age, Satisfaction, Female </code></pre>
</div>
</div>
<p>　これまで普通に表示されていた<code>Female</code>列が見えなくなった。これは{marginaleffects}の仕様上の問題だが、<code>print()</code>関数の中に<code>style = "data.frame"</code>を指定すると問題なく表示される。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 08</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">print</span>(fit1_pred, <span class="at">style =</span> <span class="st">"data.frame"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   rowid estimate std.error statistic       p.value   s.value  conf.low conf.high TempKyosan
1      1 31.26953 1.0476813 29.846411 9.772659e-196 647.80916 29.216108  33.32294     26.882
2      2 34.92279 1.0566911 33.049191 1.597783e-239 793.26474 32.851711  36.99386     26.882
3      3 26.53784 0.6849277 38.745466  0.000000e+00       Inf 25.195410  27.88028     26.882
4      4 31.09269 0.6679046 46.552583  0.000000e+00       Inf 29.783617  32.40175     26.882
5      5 21.80616 0.6861641 31.779807 1.230741e-221 733.84658 20.461305  23.15102     26.882
6      6 27.26258 0.7226681 37.724903  0.000000e+00       Inf 25.846181  28.67899     26.882
7      7 17.07448 1.0501055 16.259777  1.904310e-59 195.06449 15.016312  19.13265     26.882
8      8 23.43248 1.1597646 20.204515  8.934294e-91 299.13610 21.159385  25.70558     26.882
9      9 12.34280 1.5377994  8.026273  1.004781e-15  49.82204  9.328767  15.35683     26.882
10    10 19.60238 1.7071942 11.482221  1.620634e-30  98.96128 16.256341  22.94842     26.882
   Interest Ideology   Age Satisfaction Female
1  2.736333 6.340667 47.34            1   男性
2  2.736333 6.340667 47.34            1   女性
3  2.736333 6.340667 47.34            2   男性
4  2.736333 6.340667 47.34            2   女性
5  2.736333 6.340667 47.34            3   男性
6  2.736333 6.340667 47.34            3   女性
7  2.736333 6.340667 47.34            4   男性
8  2.736333 6.340667 47.34            4   女性
9  2.736333 6.340667 47.34            5   男性
10 2.736333 6.340667 47.34            5   女性</code></pre>
</div>
</div>
<p>　問題なく<code>Female</code>列がリコーディングされていることが分かる。それではこの<code>fit1_pred</code>を利用し、可視化してみよう。ここではpoint-rangeプロットを作成し、性別に応じてpoint-rangeの色分けを行う。また、性別ごとのpoint-rangeを横方向にずらすために<code>aes()</code>の<strong>外</strong>側に<code>position = position_dodge2(0.5)</code>を追加する。この0.5の数値が小さいほど2つのpoint-rangeはより近くなる。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 09</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>fit1_pred <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> Satisfaction, </span>
<span id="cb14-4"><a href="#cb14-4"></a>                      <span class="at">y =</span> estimate, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high, </span>
<span id="cb14-5"><a href="#cb14-5"></a>                      <span class="at">color =</span> Female),</span>
<span id="cb14-6"><a href="#cb14-6"></a>                  <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"政治満足度"</span>, <span class="at">y =</span> <span class="st">"共産感情温度の予測値と95%信頼区間 (度)"</span>,</span>
<span id="cb14-8"><a href="#cb14-8"></a>       <span class="at">fill =</span> <span class="st">""</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interaction_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050"></p>
</figure>
</div>
</div>
</div>
<p>　もう一つの可視化方法はリボンと折れ線グラフの組み合わせである。リボンの色塗りは<code>fill</code>でマッピングし、リボンが重なる可能性を考慮し<code>aes()</code>の<strong>外</strong>側に<code>alpha</code>引数を追加して透明度を調整しよう。宋のおすすめは0.3だ。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 10</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>fit1_pred <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Satisfaction)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">y =</span> estimate, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high, <span class="at">fill =</span> Female), </span>
<span id="cb15-4"><a href="#cb15-4"></a>              <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> estimate, <span class="at">color =</span> Female), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"政治満足度"</span>, <span class="at">y =</span> <span class="st">"共産感情温度の予測値と95%信頼区間 (度)"</span>,</span>
<span id="cb15-7"><a href="#cb15-7"></a>       <span class="at">fill =</span> <span class="st">""</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interaction_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050"></p>
</figure>
</div>
</div>
</div>
<p>　Point-rangeプロットにするか、リボン+折れ線の組み合わせにするかは好みの問題なので自分からみて読みやすいと思う図にしよう。</p>
</section>
<section id="モデル2の解釈" class="level3">
<h3 class="anchored" data-anchor-id="モデル2の解釈">モデル2の解釈</h3>
<p>　モデル2（<code>fit2</code>）に対しても同じことが言える。まずは回帰式をまとめてみよう。</p>
<p>共産に対する感情温度の予測値 = 28.25 + 3.31 <span class="math inline">\(\times\)</span> <strong>政治満足度</strong> + 0.36 <span class="math inline">\(\times\)</span> 年齢 - 0.12 <span class="math inline">\(\times\)</span> 政治関心 - 1.69 <span class="math inline">\(\times\)</span> イデオロギー + 5.06 <span class="math inline">\(\times\)</span> 女性ダミー - 0.16 <span class="math inline">\(\times\)</span> 政治満足度 <span class="math inline">\(\times\)</span> 年齢</p>
<p>　これを政治満足度でまとめると、</p>
<p>共産に対する感情温度の予測値 = 28.25 + (3.31 - 0.16 <span class="math inline">\(\times\)</span> 年齢) <span class="math inline">\(\times\)</span> <strong>政治満足度</strong> + 0.36 <span class="math inline">\(\times\)</span> 年齢 - 0.12 <span class="math inline">\(\times\)</span> 政治関心 - 1.69 <span class="math inline">\(\times\)</span> イデオロギー + 5.06 <span class="math inline">\(\times\)</span> 女性ダミー</p>
<p>になる。つまり、政治満足度が共産感情温度に与える影響は「(3.31 - 0.16 <span class="math inline">\(\times\)</span> 年齢の値)」だ。年齢は18、19、20、…など様々な値を取り得る。これら全てに対して計算することは効率的ではないため、ここでは年齢が20歳、40歳、60歳の場合に絞って政治満足度が共産感情温度に与える影響を計算してみよう。</p>
<p>　まず、20歳の場合（<code>Age</code>の値 = 20）、政治満足度が共産感情温度に与える影響は約0.11（= 3.31 - 0.16 <span class="math inline">\(\times\)</span> 20）である（小数点7桁まで計算すると約0.1724813）。これは「20歳の場合、政治満足度が1単位上がると、共産に対する感情温度は約0.11度上がる」ことを意味する。つづいて、40歳の場合（<code>Age</code>の値 = 40）、政治満足度が共産感情温度に与える影響は約-3.09（= 3.31 - 0.16 <span class="math inline">\(\times\)</span> 40）である（小数点7桁まで計算すると約-2.962879）。これは「40歳の場合、政治満足度が1単位上がると、共産に対する感情温度は約3.09度下がる」ことを意味する。最後に60歳の場合（<code>Age</code>の値 = 60）、政治満足度が共産感情温度に与える影響は約-6.29（= 3.31 - 0.16 <span class="math inline">\(\times\)</span> 60）だ（小数点7桁まで計算すると約-6.098239）。これは「60歳の場合、政治満足度が1単位上がると、共産に対する感情温度は約6.29度下がる」ことを意味する。</p>
<p>　以上の結果を回帰直線で示したものが以下の図である。<code>fit2</code>の調整変数は連続変数であるためすべての年齢に応じた回帰直線を出すのはあまりにも非効率的である。したがって、ここでは20、40、60歳の場合の回帰直線を可視化してみよう。今回は一連の作業をすべてパイプ演算子（<code>|&gt;</code>）で繋ぎ、一つのコードにまとめてみた。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 11</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>fit2 <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">predictions</span>(<span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">Satisfaction =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, </span>
<span id="cb16-3"><a href="#cb16-3"></a>                                 <span class="at">Age          =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>))) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">mutate</span>(<span class="at">Age =</span> <span class="fu">recode</span>(Age, </span>
<span id="cb16-5"><a href="#cb16-5"></a>                      <span class="st">"20"</span> <span class="ot">=</span> <span class="st">"20歳"</span>,</span>
<span id="cb16-6"><a href="#cb16-6"></a>                      <span class="st">"40"</span> <span class="ot">=</span> <span class="st">"40歳"</span>,</span>
<span id="cb16-7"><a href="#cb16-7"></a>                      <span class="st">"60"</span> <span class="ot">=</span> <span class="st">"60歳"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Satisfaction)) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high, <span class="at">fill =</span> Age),</span>
<span id="cb16-10"><a href="#cb16-10"></a>              <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> estimate, <span class="at">color =</span> Age), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"政治満足度"</span>, <span class="at">y =</span> <span class="st">"共産感情温度の予測値 (度)"</span>, <span class="at">fill =</span> <span class="st">"年齢"</span>, <span class="at">color =</span> <span class="st">"年齢"</span>) <span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb16-14"><a href="#cb16-14"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interaction_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1050"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="限界効果の話" class="level2">
<h2 class="anchored" data-anchor-id="限界効果の話">限界効果の話</h2>
<p>　交互作用とは説明変数<span class="math inline">\(X\)</span>が応答変数<span class="math inline">\(Y\)</span>に与える影響が調整変数<span class="math inline">\(Z\)</span>の値に依存することを意味する。この場合、「説明変数<span class="math inline">\(X\)</span>が応答変数<span class="math inline">\(Y\)</span>に与える影響」の統計的有意性はどうだろうか。<span class="math inline">\(X\)</span>が<span class="math inline">\(Y\)</span>に与える影響の統計的有意性を検定する際に用いられる検定統計量は「<span class="math inline">\(X\)</span>の係数 / <span class="math inline">\(X\)</span>の標準誤差」である。しかし、ここでの<span class="math inline">\(X\)</span>の係数（と標準誤差）は<span class="math inline">\(Z\)</span>の値によって変わる。これは<span class="math inline">\(Z\)</span>の値によって<span class="math inline">\(X \rightarrow Y\)</span>の統計的有意性は変わることを意味する。</p>
<p>　したがって、<span class="math inline">\(Z\)</span>の値ごとに、<span class="math inline">\(X\)</span>が<span class="math inline">\(Y\)</span>に与える影響（= <strong>限界効果</strong>; marginal effects）を計算するだけでなく、95%信頼区間 or <span class="math inline">\(p\)</span>値も示す必要がある。95%信頼区間内に0が含まれないことは、<span class="math inline">\(p &lt; 0.05\)</span>を意味するため、統計的に有意な関連があると判断する。</p>
<p>　限界効果の計算方法については解説済みである。しかし、統計的有意性に関しては説明がやや難しくなるため、これはRパッケージにお任せするとしよう。もし、数学的な背景に関心のある履修者は<a href="https://www.cambridge.org/core/journals/political-analysis/article/abs/understanding-interaction-models-improving-empirical-analyses/9BA57B3720A303C61EBEC6DDFA40744B">Brambor (2006)</a>を参照されたい。</p>
<p>　今回使用するパッケージ&amp;関数は、冒頭で読み込んだ{marginaleffect}パッケージの<code>slopes()</code>関数だ。これは回帰モデルの限界効果と統計的有意性検定までやってくれる大変便利なパッケージである。使い方は以下の通り。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">slopes</span>(回帰オブジェクト名, <span class="at">variables =</span> <span class="st">"説明変数名"</span>, </span>
<span id="cb17-2"><a href="#cb17-2"></a>       <span class="at">newdata =</span> <span class="fu">datagrid</span>(調整変数名 <span class="ot">=</span> 調整変数の値))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　<code>fit1</code>の場合、<code>Female</code>の値が0と1の場合の<code>Satisfacton</code>の限界効果を求めることになる。したがって、回帰オブジェクト名は<code>fit1</code>、<code>variables</code>の実引数は<code>"Satisfaction"</code>（<code>"</code>で囲む）、<code>datagrid()</code>の中身は<code>Female = 0:1</code>または<code>Female = c(0, 1)</code>だ。計算結果を<code>fit1_ame</code>に格納し、中身を確認する。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 12</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>fit1_ame <span class="ot">&lt;-</span> <span class="fu">slopes</span>(fit1, <span class="at">variables =</span> <span class="st">"Satisfaction"</span>, <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">Female =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a>fit1_ame</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
         Term Female Estimate Std. Error     z Pr(&gt;|z|)    S 2.5 % 97.5 %
 Satisfaction      0    -4.73      0.561 -8.43   &lt;0.001 54.7 -5.83  -3.63
 Satisfaction      1    -3.83      0.611 -6.27   &lt;0.001 31.3 -5.03  -2.63

Columns: rowid, term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, Female, predicted_lo, predicted_hi, predicted, TempKyosan, Satisfaction, Interest, Ideology, Age 
Type:  response </code></pre>
</div>
</div>
<p>　非常に多くの情報が出力されるが、ここで興味のある列は<code>Female</code>の値（<code>Female</code>列）と、<code>Satisfaction</code>の限界効果（<code>Estiamte</code>列）、<span class="math inline">\(p\)</span>値（<code>Pr(&gt;|z|)</code>列）、95%信頼区間（<code>2.5%</code>列と<code>97.5%</code>列）である。それでは、<code>select()</code>関数で<code>fit1_ame</code>からこれらの列のみ出力してみよう。</p>
<p>　前回の講義では、<code>predictions()</code>関数から得られた推定結果のオブジェクトを出力すると表示される列名と実際の列名は異なることを説明したが、<code>slopes()</code>も同様である。実際の列名を見たい場合は<code>print()</code>関数を使用し、<code>style = "data.frame"</code>引数を追加しよう。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 13</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">print</span>(fit1_ame, <span class="at">style =</span> <span class="st">"data.frame"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  rowid         term  estimate std.error statistic      p.value  s.value  conf.low conf.high Female
1     1 Satisfaction -4.731682 0.5613381 -8.429291 3.477671e-17 54.67466 -5.831884 -3.631479      0
2     2 Satisfaction -3.830102 0.6111591 -6.266947 3.681947e-10 31.33881 -5.027952 -2.632252      1
  predicted_lo predicted_hi predicted TempKyosan Satisfaction Interest Ideology   Age
1     24.41427     24.41237  24.41332     26.882        2.449 2.736333 6.340667 47.34
2     29.37374     29.37220  29.37297     26.882        2.449 2.736333 6.340667 47.34</code></pre>
</div>
</div>
<p>　限界効果の解釈に話を戻そう。限界効果は<code>estiamte</code>列に表示されており、<code>Female = 0</code>の場合の<code>Satisfaction</code>の限界効果は約-4.732、<code>Female = 1</code>の場合のそれは約-3.830である。また、いずれも<span class="math inline">\(p\)</span>値が0.05を下回ることから統計的に有意な関係であることがわかる。つまり、性別と関係なく、政治満足度は共産感情温度に負の影響を与えることが分かる。</p>
<p>　これらの結果を表でまとめると以下のようになる。表で<span class="math inline">\(p\)</span>値を報告する場合、<span class="math inline">\(p\)</span>値が非常に小さいケースがある（たとえば、<span class="math inline">\(p\)</span> = 0.0000000235）。この場合、「<span class="math inline">\(p\)</span> = 0.000」と表記せず、「<span class="math inline">\(p\)</span> &lt; 0.001」と表記すること。<span class="math inline">\(p\)</span>値がぴったり0になることは実質的にあり得ない。</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="gkihyucnjw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#gkihyucnjw table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#gkihyucnjw thead, #gkihyucnjw tbody, #gkihyucnjw tfoot, #gkihyucnjw tr, #gkihyucnjw td, #gkihyucnjw th {
  border-style: none;
}

#gkihyucnjw p {
  margin: 0;
  padding: 0;
}

#gkihyucnjw .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gkihyucnjw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#gkihyucnjw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gkihyucnjw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gkihyucnjw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gkihyucnjw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gkihyucnjw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gkihyucnjw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gkihyucnjw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gkihyucnjw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gkihyucnjw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gkihyucnjw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gkihyucnjw .gt_spanner_row {
  border-bottom-style: hidden;
}

#gkihyucnjw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#gkihyucnjw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gkihyucnjw .gt_from_md > :first-child {
  margin-top: 0;
}

#gkihyucnjw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gkihyucnjw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gkihyucnjw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gkihyucnjw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gkihyucnjw .gt_row_group_first td {
  border-top-width: 2px;
}

#gkihyucnjw .gt_row_group_first th {
  border-top-width: 2px;
}

#gkihyucnjw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gkihyucnjw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gkihyucnjw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gkihyucnjw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gkihyucnjw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gkihyucnjw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gkihyucnjw .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#gkihyucnjw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gkihyucnjw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gkihyucnjw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gkihyucnjw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gkihyucnjw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gkihyucnjw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gkihyucnjw .gt_left {
  text-align: left;
}

#gkihyucnjw .gt_center {
  text-align: center;
}

#gkihyucnjw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gkihyucnjw .gt_font_normal {
  font-weight: normal;
}

#gkihyucnjw .gt_font_bold {
  font-weight: bold;
}

#gkihyucnjw .gt_font_italic {
  font-style: italic;
}

#gkihyucnjw .gt_super {
  font-size: 65%;
}

#gkihyucnjw .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#gkihyucnjw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gkihyucnjw .gt_indent_1 {
  text-indent: 5px;
}

#gkihyucnjw .gt_indent_2 {
  text-indent: 10px;
}

#gkihyucnjw .gt_indent_3 {
  text-indent: 15px;
}

#gkihyucnjw .gt_indent_4 {
  text-indent: 20px;
}

#gkihyucnjw .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings gt_spanner_row">
<th rowspan="2" id="性別" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">性別</th>
<th rowspan="2" id="平均限界効果" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">平均限界効果</th>
<th rowspan="2" id="p値" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">p値</th>
<th colspan="2" id="95%信頼区間" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><span class="gt_column_spanner">95%信頼区間</span></th>
</tr>
<tr class="odd gt_col_headings">
<th id="下限" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">下限</th>
<th id="上限" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">上限</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Female">男性</td>
<td class="gt_row gt_right" headers="estimate">−4.732</td>
<td class="gt_row gt_right" headers="p.value">&lt; 0.001</td>
<td class="gt_row gt_right" headers="conf.low">−5.832</td>
<td class="gt_row gt_right" headers="conf.high">−3.631</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Female">女性</td>
<td class="gt_row gt_right" headers="estimate">−3.830</td>
<td class="gt_row gt_right" headers="p.value">&lt; 0.001</td>
<td class="gt_row gt_right" headers="conf.low">−5.028</td>
<td class="gt_row gt_right" headers="conf.high">−2.632</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>　続いて、<code>fit2</code>の場合の<code>Age</code>の値が18、19、20、…、75の場合の<code>Satisfaction</code>の限界効果を求めるてみよう。回帰オブジェクト名は<code>fit2</code>、<code>variables</code>の実引数は<code>"Satisfaction"</code>（<code>"</code>で囲む）、<code>datagrid()</code>の中身は<code>Age = 18:75</code>だ（18から75まで公差1の等差数列）。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 14</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>fit2_ame <span class="ot">&lt;-</span> <span class="fu">slopes</span>(fit2, <span class="at">variables =</span> <span class="st">"Satisfaction"</span>, <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">Age =</span> <span class="dv">18</span><span class="sc">:</span><span class="dv">75</span>))</span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a>fit2_ame</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
         Term Age Estimate Std. Error        z Pr(&gt;|z|)   S  2.5 % 97.5 %
 Satisfaction  18   0.4860      0.913   0.5323    0.595 0.8  -1.30   2.28
 Satisfaction  19   0.3292      0.890   0.3700    0.711 0.5  -1.42   2.07
 Satisfaction  20   0.1725      0.866   0.1992    0.842 0.2  -1.53   1.87
 Satisfaction  21   0.0157      0.843   0.0186    0.985 0.0  -1.64   1.67
 Satisfaction  22  -0.1411      0.820  -0.1720    0.863 0.2  -1.75   1.47
--- 48 rows omitted. See ?avg_slopes and ?print.marginaleffects --- 
 Satisfaction  71  -7.8227      0.724 -10.8071   &lt;0.001 88.0  -9.24  -6.40
 Satisfaction  72  -7.9795      0.746 -10.7029   &lt;0.001 86.4  -9.44  -6.52
 Satisfaction  73  -8.1362      0.768 -10.5965   &lt;0.001 84.7  -9.64  -6.63
 Satisfaction  74  -8.2930      0.791 -10.4875   &lt;0.001 83.1  -9.84  -6.74
 Satisfaction  75  -8.4498      0.813 -10.3960   &lt;0.001 81.7 -10.04  -6.86
Columns: rowid, term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, Age, predicted_lo, predicted_hi, predicted, TempKyosan, Satisfaction, Interest, Ideology, Female 
Type:  response </code></pre>
</div>
</div>
<p>　いくつか気になる点がある。普通に<code>fit2_ame</code>のみ入力して出力すると、最初の5行と最後の5行のみが出力され、48行分が省略される。もし、すべての行を出力したい場合は、<code>print()</code>関数を使用し、<code>topn = Inf</code>引数を追加すれば良い。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 15</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">print</span>(fit2_ame, <span class="at">topn =</span> <span class="cn">Inf</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
         Term Age Estimate Std. Error        z Pr(&gt;|z|)     S  2.5 %  97.5 %
 Satisfaction  18   0.4860      0.913   0.5323  0.59453   0.8  -1.30  2.2756
 Satisfaction  19   0.3292      0.890   0.3700  0.71142   0.5  -1.42  2.0736
 Satisfaction  20   0.1725      0.866   0.1992  0.84214   0.2  -1.53  1.8700
 Satisfaction  21   0.0157      0.843   0.0186  0.98513   0.0  -1.64  1.6681
 Satisfaction  22  -0.1411      0.820  -0.1720  0.86345   0.2  -1.75  1.4664
 Satisfaction  23  -0.2978      0.797  -0.3735  0.70878   0.5  -1.86  1.2650
 Satisfaction  24  -0.4546      0.775  -0.5866  0.55747   0.8  -1.97  1.0643
 Satisfaction  25  -0.6114      0.753  -0.8121  0.41676   1.3  -2.09  0.8642
 Satisfaction  26  -0.7681      0.731  -1.0506  0.29346   1.8  -2.20  0.6649
 Satisfaction  27  -0.9249      0.709  -1.3038  0.19230   2.4  -2.32  0.4655
 Satisfaction  28  -1.0817      0.688  -1.5718  0.11599   3.1  -2.43  0.2671
 Satisfaction  29  -1.2384      0.667  -1.8567  0.06336   4.0  -2.55  0.0689
 Satisfaction  30  -1.3952      0.646  -2.1589  0.03086   5.0  -2.66 -0.1286
 Satisfaction  31  -1.5520      0.627  -2.4754  0.01331   6.2  -2.78 -0.3232
 Satisfaction  32  -1.7087      0.608  -2.8102  0.00495   7.7  -2.90 -0.5170
 Satisfaction  33  -1.8655      0.588  -3.1710  0.00152   9.4  -3.02 -0.7124
 Satisfaction  34  -2.0223      0.570  -3.5507  &lt; 0.001  11.3  -3.14 -0.9060
 Satisfaction  35  -2.1790      0.552  -3.9465  &lt; 0.001  13.6  -3.26 -1.0969
 Satisfaction  36  -2.3358      0.535  -4.3637  &lt; 0.001  16.3  -3.38 -1.2867
 Satisfaction  37  -2.4926      0.519  -4.8017  &lt; 0.001  19.3  -3.51 -1.4752
 Satisfaction  38  -2.6493      0.504  -5.2573  &lt; 0.001  22.7  -3.64 -1.6616
 Satisfaction  39  -2.8061      0.490  -5.7325  &lt; 0.001  26.6  -3.77 -1.8467
 Satisfaction  40  -2.9629      0.476  -6.2219  &lt; 0.001  30.9  -3.90 -2.0295
 Satisfaction  41  -3.1196      0.464  -6.7230  &lt; 0.001  35.7  -4.03 -2.2102
 Satisfaction  42  -3.2764      0.453  -7.2319  &lt; 0.001  40.9  -4.16 -2.3885
 Satisfaction  43  -3.4332      0.443  -7.7476  &lt; 0.001  46.6  -4.30 -2.5647
 Satisfaction  44  -3.5900      0.435  -8.2483  &lt; 0.001  52.5  -4.44 -2.7369
 Satisfaction  45  -3.7467      0.428  -8.7458  &lt; 0.001  58.6  -4.59 -2.9071
 Satisfaction  46  -3.9035      0.424  -9.2165  &lt; 0.001  64.8  -4.73 -3.0734
 Satisfaction  47  -4.0603      0.420  -9.6765  &lt; 0.001  71.2  -4.88 -3.2379
 Satisfaction  48  -4.2170      0.418 -10.0965  &lt; 0.001  77.2  -5.04 -3.3984
 Satisfaction  49  -4.3738      0.417 -10.4787  &lt; 0.001  82.9  -5.19 -3.5557
 Satisfaction  50  -4.5306      0.419 -10.8114  &lt; 0.001  88.1  -5.35 -3.7092
 Satisfaction  51  -4.6873      0.422 -11.1103  &lt; 0.001  92.9  -5.51 -3.8604
 Satisfaction  52  -4.8441      0.427 -11.3534  &lt; 0.001  96.8  -5.68 -4.0078
 Satisfaction  53  -5.0009      0.433 -11.5539  &lt; 0.001 100.2  -5.85 -4.1525
 Satisfaction  54  -5.1576      0.441 -11.7037  &lt; 0.001 102.7  -6.02 -4.2939
 Satisfaction  55  -5.3144      0.450 -11.8161  &lt; 0.001 104.6  -6.20 -4.4329
 Satisfaction  56  -5.4712      0.461 -11.8789  &lt; 0.001 105.7  -6.37 -4.5685
 Satisfaction  57  -5.6279      0.472 -11.9191  &lt; 0.001 106.4  -6.55 -4.7025
 Satisfaction  58  -5.7847      0.485 -11.9240  &lt; 0.001 106.5  -6.74 -4.8339
 Satisfaction  59  -5.9415      0.499 -11.9041  &lt; 0.001 106.1  -6.92 -4.9632
 Satisfaction  60  -6.0982      0.514 -11.8646  &lt; 0.001 105.4  -7.11 -5.0908
 Satisfaction  61  -6.2550      0.530 -11.7955  &lt; 0.001 104.3  -7.29 -5.2157
 Satisfaction  62  -6.4118      0.547 -11.7245  &lt; 0.001 103.0  -7.48 -5.3399
 Satisfaction  63  -6.5685      0.564 -11.6421  &lt; 0.001 101.6  -7.67 -5.4627
 Satisfaction  64  -6.7253      0.582 -11.5471  &lt; 0.001 100.0  -7.87 -5.5838
 Satisfaction  65  -6.8821      0.601 -11.4468  &lt; 0.001  98.4  -8.06 -5.7037
 Satisfaction  66  -7.0388      0.620 -11.3461  &lt; 0.001  96.7  -8.25 -5.8229
 Satisfaction  67  -7.1956      0.640 -11.2416  &lt; 0.001  95.0  -8.45 -5.9411
 Satisfaction  68  -7.3524      0.661 -11.1268  &lt; 0.001  93.1  -8.65 -6.0573
 Satisfaction  69  -7.5092      0.682 -11.0140  &lt; 0.001  91.3  -8.85 -6.1729
 Satisfaction  70  -7.6659      0.702 -10.9129  &lt; 0.001  89.7  -9.04 -6.2891
 Satisfaction  71  -7.8227      0.724 -10.8071  &lt; 0.001  88.0  -9.24 -6.4040
 Satisfaction  72  -7.9795      0.746 -10.7029  &lt; 0.001  86.4  -9.44 -6.5182
 Satisfaction  73  -8.1362      0.768 -10.5965  &lt; 0.001  84.7  -9.64 -6.6313
 Satisfaction  74  -8.2930      0.791 -10.4875  &lt; 0.001  83.1  -9.84 -6.7432
 Satisfaction  75  -8.4498      0.813 -10.3960  &lt; 0.001  81.7 -10.04 -6.8567

Columns: rowid, term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, Age, predicted_lo, predicted_hi, predicted, TempKyosan, Satisfaction, Interest, Ideology, Female 
Type:  response </code></pre>
</div>
</div>
<p>　18〜29歳の場合、政治満足度が共産感情温度に与える影響は確認できない（つまり、<span class="math inline">\(p \geq 0.05\)</span>）。一方、回答者の年齢が30歳以上の場合、政治満足度は共産感情温度に負の影響を与えるが確認できる（つまり、<span class="math inline">\(p &lt; 0.05\)</span>）。ちなみに、<code>&lt;2e-16</code>と表示されるのは0に極めて近いことを意味し、表で示す際は<code>&lt; 0.001</code>とかで表記するのが一般的だ。</p>
<p>　交互作用を含む回帰モデルの場合、調整変数ごとの予測値の図と限界効果のグラフを示すのが一般的である。予測値のグラフ同様、限界効果（<code>estimate</code>列）と信頼区間の上限と下限（それぞれ<code>conf.low</code>と<code>conf.high</code>）を示すだけで良い。</p>
<p>　まず<code>fit1</code>における政治満足度の限界効果（<code>fit1_ame</code>）を可視化してみよう。調整変数（<code>Female</code>）は2つの値（0と1）しかとらないので、point-rangeプロットが適切だろう。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 16</strong></pre>
</div>
<div class="sourceCode cell-code" id="annotated-cell-17"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-17-1"><a href="#annotated-cell-17-1"></a>fit1_ame <span class="sc">|&gt;</span></span>
<span id="annotated-cell-17-2"><a href="#annotated-cell-17-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="1">1</button><span id="annotated-cell-17-3" class="code-annotation-target"><a href="#annotated-cell-17-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="annotated-cell-17-4"><a href="#annotated-cell-17-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> Female, <span class="at">y =</span> estimate, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="annotated-cell-17-5"><a href="#annotated-cell-17-5"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"性別"</span>, <span class="at">y =</span> <span class="st">"政治満足度の限界効果と95%信頼区間"</span>) <span class="sc">+</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="2">2</button><span id="annotated-cell-17-6" class="code-annotation-target"><a href="#annotated-cell-17-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"男性"</span>, <span class="st">"女性"</span>)) <span class="sc">+</span></span>
<span id="annotated-cell-17-7"><a href="#annotated-cell-17-7"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-17" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="3" data-code-annotation="1">y = 0の水平線を追加する。</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="6" data-code-annotation="2">目盛りを0と1のみとし、それぞれ「男性」、「女性」のラベルを付ける。</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interaction_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="600"></p>
</figure>
</div>
</div>
</div>
<p>　男性でも女性でも95%信頼区間内に0が含まれておらず、どちらも統計的に有意な負の限界効果である。これは「性別と関係なく政治満足度が高まると共産党に感情温度は下がる」ことを意味する。もうちょっと具体的に解釈すると「男性の場合、政治満足度が1単位上がると共産党に対する感情温度は約4.73度低くなり、女性の場合は3.83度低くなる」ということになる。</p>
<p>　続いて、<code>fit2</code>における政治満足度の限界効果（<code>fit2_ame</code>）も確認してみよう。ここでは調整変数が取りうる値が多すぎるので、95%信頼区間を垂直線でなく、リボンとする。また縦軸を「政治満足度の平均限界効果」でなく、「政治満足度が共産感情温度に与える影響」にすることで、交互作用の知識のない読者にとって解釈しやすくした（途中の<code>\n</code>は改行を意味する）。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 17</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>fit2_ame <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age)) <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"年齢"</span>, <span class="at">y =</span> <span class="st">"政治満足度が共産感情温度に</span><span class="sc">\n</span><span class="st">与える影響と95%信頼区間"</span>) <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interaction_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="900"></p>
</figure>
</div>
</div>
</div>
<p>　29歳までは95%信頼区間に0が含まれている。30歳からは限界効果が負となり、統計的に有意な関係を示している。これは「30歳以上の有権者のみにおいて、政治満足度が高まると共産党に対する感情温度は下がる」ことを意味する。一方、「30歳未満の有権者の場合、政治満足度が共産党に対する感情温度に影響を与えるとは言えない」とも解釈できる。ここで更に詳しく解釈すると「30歳の有権者の場合、政治満足度が1度上がると、共産党に対する感情温度が約-1.40度下がり、60歳は約6.10度下がる」とも言えよう（何歳を解釈の基準にするかは好みによる）。</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.jaysong\.net\/r4ps\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, <a href="https://www.jaysong.net" target="_blank">Jaehyun Song</a>. Powered by <a href="https://quarto.org/" target="_blank">Quarto</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.jaysong.net">
      <i class="bi bi-house-fill" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/JaehyunSong">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>