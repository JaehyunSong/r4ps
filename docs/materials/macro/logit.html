<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R for Political Science - 第11回講義資料</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Figs/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9TLN2VMPQD"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-9TLN2VMPQD', { 'anonymize_ip': true});
</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../Figs/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">R for Political Science</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">シラバス</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-">    
        <li>
    <a class="dropdown-item" href="../../syllabus/syllabus_micro.html">
 <span class="dropdown-text">[前期] ミクロ政治データ分析実習</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../syllabus/syllabus_macro.html">
 <span class="dropdown-text">[後期] マクロ政治データ分析実習</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../syllabus/session.html">
 <span class="dropdown-text">セッション情報</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rの使い方" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Rの使い方</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-rの使い方">    
        <li>
    <a class="dropdown-item" href="../../intro/install.html">
 <span class="dropdown-text">Rの導入</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/rstudio.html">
 <span class="dropdown-text">RStudioの設定</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/project.html">
 <span class="dropdown-text">プロジェクト管理</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/file.html">
 <span class="dropdown-text">ファイル管理</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/filesystem.html">
 <span class="dropdown-text">ファイル管理術</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/packages.html">
 <span class="dropdown-text">パッケージ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/homework.html">
 <span class="dropdown-text">課題の取り組み方</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intro/faq.html">
 <span class="dropdown-text">この授業の「あるある」</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu--1" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">前期講義資料</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu--1">    
        <li>
    <a class="dropdown-item" href="../../materials/micro/introduction.html">
 <span class="dropdown-text">第1回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/r.html">
 <span class="dropdown-text">第2回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/basic.html">
 <span class="dropdown-text">第3回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/programming.html">
 <span class="dropdown-text">第4回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/rmarkdown.html">
 <span class="dropdown-text">第5回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/dataset.html">
 <span class="dropdown-text">第6回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/datatype.html">
 <span class="dropdown-text">第7回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/datastructure.html">
 <span class="dropdown-text">第8回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/handling1.html">
 <span class="dropdown-text">第9回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/handling2.html">
 <span class="dropdown-text">第10回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/handling3.html">
 <span class="dropdown-text">第11回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/visualization1.html">
 <span class="dropdown-text">第12回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/visualization2.html">
 <span class="dropdown-text">第13回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/micro/visualization3.html">
 <span class="dropdown-text">第14回講義資料</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu--2" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">後期講義資料</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu--2">    
        <li>
    <a class="dropdown-item" href="../../materials/macro/introduction.html">
 <span class="dropdown-text">第1回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/research_design.html">
 <span class="dropdown-text">第2・3回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/descriptive_statistics.html">
 <span class="dropdown-text">第4回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/inference.html">
 <span class="dropdown-text">第5回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/nhts.html">
 <span class="dropdown-text">第6回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/association.html">
 <span class="dropdown-text">第7回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/regression1.html">
 <span class="dropdown-text">第8回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/regression2.html">
 <span class="dropdown-text">第9回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/regression3.html">
 <span class="dropdown-text">第10回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/logit.html">
 <span class="dropdown-text">第11回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/interaction.html">
 <span class="dropdown-text">第12回講義資料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../materials/macro/reporting.html">
 <span class="dropdown-text">第13回講義資料</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu--3" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">課題</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu--3">    
        <li>
    <a class="dropdown-item" href="../../intro/homework.html">
 <span class="dropdown-text">課題の取り組み方</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">ミクロ</li>
        <li>
    <a class="dropdown-item" href="../../HW/Micro_HW05.html">
 <span class="dropdown-text">[前期] 第5回課題</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HW/Micro_HW10.html">
 <span class="dropdown-text">[前期] 第10回課題</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HW/Micro_HW11.html">
 <span class="dropdown-text">[前期] 第11回課題</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HW/Micro_HW13.html">
 <span class="dropdown-text">[前期] 第13回課題</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HW/Micro_HW14.html">
 <span class="dropdown-text">[前期] 第14回課題</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HW/Micro_Final.html">
 <span class="dropdown-text">[前期] 期末レポート</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">マクロ</li>
        <li>
    <a class="dropdown-item" href="../../HW/Macro_HW04.html">
 <span class="dropdown-text">[後期] 第4回課題</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HW/Macro_HW07.html">
 <span class="dropdown-text">[後期] 第7回課題</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HW/Macro_HW10.html">
 <span class="dropdown-text">[後期] 第10回課題</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HW/Macro_HW12.html">
 <span class="dropdown-text">[後期] 第12回課題</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HW/Macro_HW13.html">
 <span class="dropdown-text">[後期] 第13回課題</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://jupyter.cs.rcos.nii.ac.jp/"><i class="bi bi-terminal" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.jaysong.net/RBook/"><i class="bi bi-book" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">第11回講義資料</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/introduction.html" class="sidebar-item-text sidebar-link">第1回講義資料</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/research_design.html" class="sidebar-item-text sidebar-link">第2・3回講義資料</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/descriptive_statistics.html" class="sidebar-item-text sidebar-link">第4回講義資料</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/inference.html" class="sidebar-item-text sidebar-link">第5回講義資料</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/nhts.html" class="sidebar-item-text sidebar-link">第6回講義資料</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/association.html" class="sidebar-item-text sidebar-link">第7回講義資料</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/regression1.html" class="sidebar-item-text sidebar-link">第8回講義資料</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/regression2.html" class="sidebar-item-text sidebar-link">第9回講義資料</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/regression3.html" class="sidebar-item-text sidebar-link">第10回講義資料</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/logit.html" class="sidebar-item-text sidebar-link active">第11回講義資料</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/interaction.html" class="sidebar-item-text sidebar-link">第12回講義資料</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../materials/macro/reporting.html" class="sidebar-item-text sidebar-link">第13回講義資料</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#セットアップ" id="toc-セットアップ" class="nav-link active" data-scroll-target="#セットアップ">セットアップ</a></li>
  <li><a href="#線形確率モデル" id="toc-線形確率モデル" class="nav-link" data-scroll-target="#線形確率モデル">線形確率モデル</a></li>
  <li><a href="#ロジスティック回帰分析" id="toc-ロジスティック回帰分析" class="nav-link" data-scroll-target="#ロジスティック回帰分析">ロジスティック回帰分析</a>
  <ul class="collapse">
  <li><a href="#ロジスティック関数" id="toc-ロジスティック関数" class="nav-link" data-scroll-target="#ロジスティック関数">ロジスティック関数</a></li>
  <li><a href="#実装" id="toc-実装" class="nav-link" data-scroll-target="#実装">実装</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">第11回講義資料</h1>
<p class="subtitle lead">ロジスティック回帰分析</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="スライド" class="level2 unlisted">
<h2 class="unlisted anchored" data-anchor-id="スライド">スライド</h2>
<p><a href="../../slides/macro/logit.html" class="btn btn-primary btn-sm" target="_blank" role="button"><i class="bi bi-window"></i> 新しいタブで開く</a></p>
<iframe class="slide-deck" src="../../slides/macro/logit.html" width="100%" style="aspect-ratio: 16 / 9.2;"></iframe>
</section>
<section id="セットアップ" class="level2">
<h2 class="anchored" data-anchor-id="セットアップ">セットアップ</h2>
<p>　本日の実習用データ（LMSからダウンロード可能）と必要なパッケージ（{tidyverse}、{summarytools}、{marginaleffects}）を読み込む。データを読み込み、<code>df</code>という名のオブジェクトとして格納する。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 01</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(summarytools)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Data/Hino_Song.csv"</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a>df</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>　各変数の詳細はスライドを参照すること。データ分析を進める前に、まず{summarytools}の<code>descr()</code>関数を使って<code>df</code>の各変数の記述統計量を確認する。今回のデータの場合、全て連続変数（ダミー変数も連続変数として扱う）であるため、<code>df</code>をそのまま<code>descr()</code>に渡せば良い。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 02</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">descr</span>(<span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"n.valid"</span>),</span>
<span id="cb2-3"><a href="#cb2-3"></a>        <span class="at">transpose =</span> <span class="cn">TRUE</span>, <span class="at">order =</span> <span class="st">"p"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Descriptive Statistics  
df  
N: 2555  

                   Mean   Std.Dev     Min     Max   N.Valid
--------------- ------- --------- ------- ------- ---------
          Voted    0.71      0.45    0.00    1.00   2555.00
         Female    0.46      0.50    0.00    1.00   2555.00
            Age   50.91     15.69   18.00   86.00   2555.00
           Educ    3.21      0.90    1.00    4.00   2555.00
      Knowledge    3.95      1.12    1.00    5.00   2555.00
       Ideology    5.40      2.16    0.00   10.00   2555.00</code></pre>
</div>
</div>
<p>　今回は以下の問いに答えるモデルの推定を行う。</p>
<blockquote class="blockquote">
<p>　有権者の投票参加を規定する要因を調べたい。投票所に足を運ぶには予め投票先を決めておく必要があろう。しかし、数多い選択肢（候補者、政党）の中から自分の望みを実現してくれそうな選択肢を見つけることは簡単な作業ではない。政治に関する知識があれば、比較的簡単に見つかるため、投票参加しやすいと考えられる。一方、そうでない有権者は自分にとっても最適な選択肢を見つけることを諦め、棄権するだろう。これは本当だろうか。</p>
</blockquote>
<p>　まず、応答変数は回答者の投票参加の有無（<code>Voted</code>）である。こちらは投票すれば1、危険すれば0の値を取るダミー変数であり、応答変数として使う場合は<strong>二値変数</strong>、または<strong>バイナリー変数</strong>とも呼ばれる。続いて、主な説明変数は回答者の主観的な政治知識（<code>Knowledge</code>）である。また、主な説明変数以外の説明変数（=統制変数）として性別（<code>Female</code>）、年齢（<code>Age</code>）、学歴（<code>Educ</code>）、イデオロギー（<code>Ideology</code>）を投入する。このモデルを可視化すると以下のようになる。</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="logit_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="線形確率モデル" class="level2">
<h2 class="anchored" data-anchor-id="線形確率モデル">線形確率モデル</h2>
<p>　まずは、これまで紹介してきた線形回帰分析を使って、モデルを推定してみよう。推定する回帰式は以下の通りである。</p>
<p><span class="math display">\[
\widehat{\mbox{Voted}} = \alpha + \beta_1 \mbox{Knowledge} + \beta_2 \mbox{Female} + \beta_3 \mbox{Age} + \beta_4 \mbox{Educ} + \beta_5 \mbox{Ideology}
\]</span></p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 03</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>lm_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Voted <span class="sc">~</span> Knowledge <span class="sc">+</span> Female <span class="sc">+</span> Age <span class="sc">+</span> Educ <span class="sc">+</span> Ideology, <span class="at">data =</span> df)</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="fu">summary</span>(lm_fit)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Voted ~ Knowledge + Female + Age + Educ + Ideology, 
    data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.0057 -0.4242  0.1452  0.2844  0.8522 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.1093644  0.0558137  -1.959 0.050168 .  
Knowledge    0.1186971  0.0077281  15.359  &lt; 2e-16 ***
Female      -0.0549171  0.0170946  -3.213 0.001332 ** 
Age          0.0046902  0.0005579   8.408  &lt; 2e-16 ***
Educ         0.0357970  0.0096391   3.714 0.000209 ***
Ideology     0.0040744  0.0038653   1.054 0.291944    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4202 on 2549 degrees of freedom
Multiple R-squared:  0.1451,    Adjusted R-squared:  0.1435 
F-statistic: 86.55 on 5 and 2549 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>　推定の結果、政治知識（<code>Knowledge</code>）の係数は0.119が得られた。これは「政治知識が1単位上がると、投票参加の確率は約11.9%ポイント上がる」ことを意味する（「%」でなく、「%ポイント」であることに注意）。<span class="math inline">\(p\)</span>値も非常に小さく（<span class="math inline">\(p &lt; 0.05\)</span>）、統計的に有意な関係であると言えよう。</p>
<p>　このようにバイナリー変数を応答変数として使う線形回帰モデルを<strong>線形確率モデル</strong>（linear probability model; LPM）と呼ぶ。これは非常に直感的な方法であるものの、一つ大きな問題がある。たとえば、主観的政治知識（<code>Knowledge</code> = 5）が5、男性（<code>Female</code> = 0）、86歳（<code>Age</code> = 86）、教育水準が4（<code>Educ</code> = 4）、イデオロギーが10（<code>Ideology</code> = 10）の回答者がいる場合、投票に参加する確率の予測値を計算してみよう。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 04</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="sc">-</span><span class="fl">0.1093644</span> <span class="sc">+</span> <span class="fl">0.1186971</span> <span class="sc">*</span> <span class="dv">5</span> <span class="sc">-</span> <span class="fl">0.0549171</span> <span class="sc">*</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fl">0.0046902</span> <span class="sc">*</span> <span class="dv">86</span> <span class="sc">+</span> <span class="fl">0.0357970</span> <span class="sc">*</span> <span class="dv">4</span> <span class="sc">+</span> <span class="fl">0.0040744</span> <span class="sc">*</span> <span class="dv">10</span></span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.07141</code></pre>
</div>
</div>
<p>　主観的政治知識が5、男、86歳、教育水準が4、イデオロギーが10の回答者が投票に参加する確率は約107.1%である。確率は0〜100%の値を取るはずなのに、100%を超えてしまう。 他にも線形確率モデルは、線形回帰モデルの重要な仮定である分散の不均一性の満たさないなど、いくつかの問題がある。ここで登場するのがロジスティック回帰分析だ。</p>
</section>
<section id="ロジスティック回帰分析" class="level2">
<h2 class="anchored" data-anchor-id="ロジスティック回帰分析">ロジスティック回帰分析</h2>
<section id="ロジスティック関数" class="level3">
<h3 class="anchored" data-anchor-id="ロジスティック関数">ロジスティック関数</h3>
<p>　ロジスティック回帰分析を理解するためには、その背後にはるロジスティック関数に関する知識が必要である。ロジスティック関数は以下のような関数である。</p>
<p><span class="math display">\[
\text{logistic}(x) = \frac{1}{1 + e^{-x}}
\]</span></p>
<p>　式内の<span class="math inline">\(e\)</span>はネイピア数であり、2.71828184590…の無理数である。<span class="math inline">\(x\)</span>は<span class="math inline">\(-\infty \sim \infty\)</span>の値を取り得る。たとえば、<span class="math inline">\(x\)</span>が<span class="math inline">\(-\infty\)</span>の場合、<span class="math inline">\(e^{-x}\)</span>は<span class="math inline">\(e^{-(-\infty)} = \infty\)</span>、<span class="math inline">\(x\)</span>が<span class="math inline">\(\infty\)</span>の場合、<span class="math inline">\(e^{-x}\)</span>は<span class="math inline">\(e^{-\infty} = 0\)</span>となる。つまり、<span class="math inline">\(e^{-x}\)</span>は<span class="math inline">\(0 \sim \infty\)</span>の値を取る。この<span class="math inline">\(e^{-x}\)</span>が0の場合、<span class="math inline">\(\text{logistic}(x)\)</span>は1、<span class="math inline">\(e^{-x}\)</span>が<span class="math inline">\(\infty\)</span>の場合、<span class="math inline">\(\text{logistic}(x)\)</span>は0を取る。つまり、<span class="math inline">\(\text{logistic}(x)\)</span>は0以上、1以下の取ることが分かる。確率もまた0以上1以下であるため、この関数が何らかの役割を果たすこととなる。以下の図は<span class="math inline">\(x\)</span>の値ごとのロジスティック関数の折れ線グラフである。</p>
<div class="cell" data-layout-align="center" data-figh-height="4">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="logit_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<p>　<span class="math inline">\(x\)</span>の値が大きければ大きいほど、logistic(<span class="math inline">\(x\)</span>)の値は1へ近づくことが分かる。この<span class="math inline">\(x\)</span>を<span class="math inline">\(y^*\)</span>と表記した場合、ロジスティック回帰分析は</p>
<p><span class="math display">\[
\begin{align}
\mbox{Pr}(\mbox{Voted} = 1) &amp; = \frac{1}{1 + e^{-y^*}} \\
y^* &amp; = \alpha + \beta_1 \mbox{Knowledge} + \beta_2 \mbox{Female} + \beta_3 \mbox{Age} + \beta_4 \mbox{Educ} + \beta_5 \mbox{Ideology}
\end{align}
\]</span></p>
<p>における<span class="math inline">\(\alpha\)</span>、<span class="math inline">\(\beta_1\)</span>、…を推定することである。ここでの<span class="math inline">\(y^*\)</span>は<strong>線形予測子</strong>（linear predictor）と呼ばれる。</p>
</section>
<section id="実装" class="level3">
<h3 class="anchored" data-anchor-id="実装">実装</h3>
<p>　ロジスティックの実装は<code>glm()</code>関数を使用し、使い方は<code>lm()</code>関数とほぼ同様である。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">glm</span>(応答変数 <span class="sc">~</span> 説明変数, <span class="at">data =</span> データ名, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"logit"</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　<code>lm()</code>との違いは<code>family</code>引数が必要という点だ。ロジスティック回帰分析の場合は<code>family = binomial("logit")</code>、本講義では取り上げないものの同目的の分析手法であるプロビット回帰分析の場合は<code>family = binomial("probit")</code>を使用する。それでは以下のモデルを推定し、<code>fit1</code>に格納してみよう。</p>
<p><span class="math display">\[
\mbox{Pr}(\mbox{Voted} = 1) = \frac{1}{1 + e^{-(\alpha + \beta_1 \mbox{Knowledge} + \beta_2 \mbox{Female} + \beta_3 \mbox{Age} + \beta_4 \mbox{Educ} + \beta_5 \mbox{Ideology})}}
\]</span></p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 05</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Voted <span class="sc">~</span> Knowledge <span class="sc">+</span> Female <span class="sc">+</span> Age <span class="sc">+</span> Educ <span class="sc">+</span> Ideology, </span>
<span id="cb9-2"><a href="#cb9-2"></a>            <span class="at">data =</span> df, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"logit"</span>))</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="fu">summary</span>(fit1)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Voted ~ Knowledge + Female + Age + Educ + Ideology, 
    family = binomial("logit"), data = df)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.3275  -0.9980   0.5583   0.7739   2.0312  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -3.30579    0.32049 -10.315  &lt; 2e-16 ***
Knowledge    0.59290    0.04294  13.808  &lt; 2e-16 ***
Female      -0.31597    0.09628  -3.282 0.001031 ** 
Age          0.02651    0.00320   8.284  &lt; 2e-16 ***
Educ         0.20827    0.05430   3.835 0.000125 ***
Ideology     0.02392    0.02254   1.061 0.288586    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3078.9  on 2554  degrees of freedom
Residual deviance: 2700.6  on 2549  degrees of freedom
AIC: 2712.6

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
ロジスティック回帰分析の決定係数?
</div>
</div>
<div class="callout-body-container callout-body">
<p>ロジスティック回帰分析の場合、決定係数（<span class="math inline">\(R^2\)</span>）は表示されない。類似した概念として「疑似決定係数（Pseudo<span class="math inline">\(R^2\)</span>）」があるが、あまり使われない。どうしても疑似決定係数を出したい場合は{DescTools}パッケージの<code>PseduoR2()</code>関数を使う。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 06</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># 予め{DescTools}をインストールしておくこと (コンソール上でinstall.packages("DescTools"))</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>DescTools<span class="sc">::</span><span class="fu">PseudoR2</span>(fit1) <span class="co"># McFaddenの疑似決定係数</span></span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> McFadden 
0.1228484 </code></pre>
</div>
</div>
</div>
</div>
<p>　それでは結果を解釈してみよう。線形確率モデルと同様、政治知識の<span class="math inline">\(p\)</span>値は0.001未満であり、「主観的な政治知識と投票参加の間には統計的に有意な関係がある」ことが分かる。また、係数の符号（今回は+）を考えると、「主観的な政治知識が高くなると、投票に参加する確率も上がる」とも言えよう。しかし、政治知識が1単位上がると、投票参加の確率は<strong>具体的にどれくらい上がるか</strong>。線形確率モデルの場合は係数をそのまま解釈するだけで、具体的な上がりの度合いが分かったが、ロジスティック回帰分析では違う。</p>
<p>　たとえば、政治知識の係数は約0.593であるが、「主観的な政治知識が1上がると、投票参加の確率が0.593%p上がる」ということは完全な間違いである。これをどう解釈すべきだろうか。</p>
<p>　たおてば、主観的政治知識が3（<code>Knowledge</code> = 3）、女性（<code>Female</code> = 1）、20歳（<code>Age</code> = 20）、学歴が大卒（<code>Educ</code> = 4）、イデオロギーが中道（<code>Ideology</code> = 5）の場合の投票参加の予測確率を計算してみよう。まず、<code>coef()</code>関数で係数のみを抽出してみよう。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 07</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>fit1_coef <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit1) <span class="co"># coef()関数で係数のみを抽出する</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>fit1_coef</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)   Knowledge      Female         Age        Educ    Ideology 
-3.30579506  0.59290164 -0.31596873  0.02650943  0.20827008  0.02391612 </code></pre>
</div>
</div>
<p>　続いて、切片には1を、その他の係数には各変数の具体的な値をかけて合計を求める。これが線形予測子だ。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 08</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>fit1_coef[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">1</span> <span class="sc">+</span> fit1_coef[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">3</span> <span class="sc">+</span> fit1_coef[<span class="dv">3</span>] <span class="sc">*</span> <span class="dv">1</span> <span class="sc">+</span> fit1_coef[<span class="dv">4</span>] <span class="sc">*</span> <span class="dv">20</span> <span class="sc">+</span> fit1_coef[<span class="dv">5</span>] <span class="sc">*</span> <span class="dv">4</span> <span class="sc">+</span> fit1_coef[<span class="dv">6</span>] <span class="sc">*</span> <span class="dv">5</span></span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
 -0.3602094 </code></pre>
</div>
</div>
<p>　同じ長さのベクトルが2つあれば、同じ位置同士の要素が計算されることを考えると、以下のように線形予測子を計算することもできる。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 09</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">sum</span>(<span class="fu">coef</span>(fit1) <span class="sc">*</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">4</span>, <span class="dv">5</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.3602094</code></pre>
</div>
</div>
<p>　あとは線形予測子の値をロジスティック関数に代入するだけだ。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 10</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>(<span class="sc">-</span><span class="fl">0.3602094</span>))) <span class="co"># 予測確率の計算</span></span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4109089</code></pre>
</div>
</div>
<p>　結果は0.411であり、これは投票参加の予測確率は約41.1%であるこを意味する（以下の図を参照）。</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="logit_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<p>　このような作業をより簡単にしてくれるのが、前回の講義で登場した{marginaleffects}パッケージである。このパッケージが提供する<code>predictions()</code>関数の利用すれば予測確率が簡単に計算できる。使い方は以下の通りである。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">predictions</span>(回帰分析オブジェクト名, </span>
<span id="cb21-2"><a href="#cb21-2"></a>            <span class="at">newdata =</span> <span class="fu">datagrid</span>(説明変数名1 <span class="ot">=</span> 値,</span>
<span id="cb21-3"><a href="#cb21-3"></a>                               説明変数名2 <span class="ot">=</span> 値,</span>
<span id="cb21-4"><a href="#cb21-4"></a>                               ...))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　たとえば、先程の例を<code>predictions()</code>関数で計算してみよう。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 11</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">predictions</span>(fit1, <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">Knowledge =</span> <span class="dv">3</span>, </span>
<span id="cb22-2"><a href="#cb22-2"></a>                                     <span class="at">Female    =</span> <span class="dv">1</span>,</span>
<span id="cb22-3"><a href="#cb22-3"></a>                                     <span class="at">Age       =</span> <span class="dv">20</span>, </span>
<span id="cb22-4"><a href="#cb22-4"></a>                                     <span class="at">Educ      =</span> <span class="dv">4</span>, </span>
<span id="cb22-5"><a href="#cb22-5"></a>                                     <span class="at">Ideology  =</span> <span class="dv">5</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Estimate Std. Error     z   Pr(&gt;|z|)  2.5 % 97.5 % Knowledge Female Age Educ
   0.4109    0.02923 14.06 &lt; 2.22e-16 0.3551 0.4692         3      1  20    4
 Ideology
        5

Prediction type:  response 
Columns: rowid, type, estimate, std.error, statistic, p.value, conf.low, conf.high, Voted, Knowledge, Female, Age, Educ, Ideology </code></pre>
</div>
</div>
<p>　<code>datagrid()</code>内で変数を特定の値で指定しない場合、その変数は自動的に<strong>平均値</strong>が代入される。たとえば、<code>Knowledge</code>が1〜5の場合の投票参加確率の予測値を計算してみよう。その他の変数はすべて平均値に固定する。計算結果は<code>fit1_pred</code>に格納する。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 12</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>fit1_pred <span class="ot">&lt;-</span> <span class="fu">predictions</span>(fit1, <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">Knowledge =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a>fit1_pred</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Estimate Std. Error     z   Pr(&gt;|z|)  2.5 % 97.5 % Knowledge
   0.3294   0.027936 11.79 &lt; 2.22e-16 0.2771 0.3863         1
   0.4705   0.022009 21.38 &lt; 2.22e-16 0.4277 0.5138         2
   0.6165   0.013584 45.39 &lt; 2.22e-16 0.5896 0.6428         3
   0.7442   0.009492 78.40 &lt; 2.22e-16 0.7251 0.7623         4
   0.8403   0.009821 85.56 &lt; 2.22e-16 0.8201 0.8587         5

Prediction type:  response 
Columns: rowid, type, estimate, std.error, statistic, p.value, conf.low, conf.high, Voted, Female, Age, Educ, Ideology, Knowledge </code></pre>
</div>
</div>
<p>　<code>Knowledge</code>の値に応じた投票参加の予測確率（0以上、1以下）が<code>Estimate</code>列に出力され、95%信頼区間の下限と上限は<code>2.5%</code>、<code>97.5%</code>列に表示される。ただし、<strong>こちらで表示された列名は本当の列名ではない</strong>。つまり、この<code>fit1_pred</code>を用いて作図をする際、<code>Estimate</code>や<code>2.5%</code>という名前でマッピングすることはできない。今出力された列名はあくまでも読みやすさを重視したものであり、実際の列名は異なる。他にも実際にはあるものの出力されていない列も存在する。すべての列を、本当の列名と共に出力するなら、<code>print()</code>関数を使用し、<code>style = "data.frame"</code>を追加しよう。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 13</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">print</span>(fit1_pred, <span class="at">style =</span> <span class="st">"data.frame"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  rowid     type  estimate   std.error statistic       p.value  conf.low
1     1 response 0.3293996 0.027936256  11.79111  4.337629e-32 0.2771235
2     2 response 0.4705341 0.022008655  21.37950 2.073214e-101 0.4277233
3     3 response 0.6165432 0.013584204  45.38677  0.000000e+00 0.5895934
4     4 response 0.7441789 0.009492179  78.39916  0.000000e+00 0.7251353
5     5 response 0.8403326 0.009821140  85.56365  0.000000e+00 0.8201318
  conf.high    Voted   Female      Age     Educ Ideology Knowledge
1 0.3862676 0.709589 0.458317 50.91155 3.207436 5.400391         1
2 0.5137829 0.709589 0.458317 50.91155 3.207436 5.400391         2
3 0.6427954 0.709589 0.458317 50.91155 3.207436 5.400391         3
4 0.7623355 0.709589 0.458317 50.91155 3.207436 5.400391         4
5 0.8586556 0.709589 0.458317 50.91155 3.207436 5.400391         5</code></pre>
</div>
</div>
<p>　<code>Estimate</code>の本当の列名は<code>estimate</code>、<code>2.5%</code>と<code>97.5%</code>の本当の列名は<code>conf.low</code>、<code>conf.high</code>であることが分かる。今回はここまで知らなくても良いかも知れないが、第13回（推定結果の可視化）では、この点を理解しないと絶対に作図できないため注意しておこう。</p>
<p>　話を戻そう。これまでの結果を見れば、<code>Knowledge</code>が<code>Voted</code>に与える影響は一定ではないことがわかる。たとえば、<code>Knowledge</code>の値が1の場合、投票に参加する確率は32.94%である。ここで<code>Knowledge</code>の値が2の場合、投票に参加する確率は47.05%であり、14.11%<strong>p</strong>増加したことが分かる（14.11「%」でなく、14.11「%p」であることに注意しよう。%pは「パーセントポイント」と読む）。それでは<code>Knowledge</code>の値が3の場合はどうだろうか。この場合の投票参加の確率は61.65%であり、先より14.60%<strong>p</strong>増加した。また、<code>Knowledge</code>の値が4の場合の予測確率は74.42%（12.77%<strong>p</strong>増加）、5の場合のそれはは84.03%で、9.61%<strong>p</strong>増加したことが分かる。このようにロジスティック関数（から得られた曲線）の形が非線形であることを考えると、ある意味、当たり前のことであろう。</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="logit_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<p>　したがって、ロジスティック回帰分析を行う場合、「Xが1単位上がるとYはZZ上がる/下がる」という表現はあまり使わず、文章では「正（負）の関係がある」、「統計的に有意な関係は見られない」程度とし、予測確率をグラフとして示すのが一般的である。たとえば、以上の結果を可視化したものが以下の図である。可視化については次回の講義で解説する。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 14</strong></pre>
</div>
<details>
<summary>コード</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>fit1_pred <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> Knowledge, <span class="at">y =</span> estimate, </span>
<span id="cb28-4"><a href="#cb28-4"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"主観的な政治知識"</span>, </span>
<span id="cb28-6"><a href="#cb28-6"></a>       <span class="at">y =</span> <span class="st">"投票に参加する確率の予測値"</span>) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="logit_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<p>　<code>Age</code>のように説明変数の中でも取り得る値が多い場合は以下のような図になってしまい、人によっては少し気持ち悪い図になってしまう。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 14</strong></pre>
</div>
<details>
<summary>コード</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">predictions</span>(fit1, <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">Age =</span> <span class="dv">18</span><span class="sc">:</span><span class="dv">86</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">y =</span> estimate, </span>
<span id="cb29-4"><a href="#cb29-4"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"年齢 (歳)"</span>, <span class="at">y =</span> <span class="st">"投票に参加する確率の予測値"</span>) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>), </span>
<span id="cb29-7"><a href="#cb29-7"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>)) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="logit_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>
<p>　したがって、取り得る値が多い連続変数を横軸にする場合は、折れ線グラフ (<code>geom_line()</code>)とリボン (<code>geom_ribbon()</code>)を併用することが一般的だ。</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Code 14</strong></pre>
</div>
<details>
<summary>コード</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>fit1_pred2 <span class="ot">&lt;-</span> <span class="fu">predictions</span>(fit1, <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">Age =</span> <span class="dv">18</span><span class="sc">:</span><span class="dv">86</span>))</span>
<span id="cb30-2"><a href="#cb30-2"></a></span>
<span id="cb30-3"><a href="#cb30-3"></a>fit1_pred2 <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), </span>
<span id="cb30-6"><a href="#cb30-6"></a>              <span class="at">fill =</span> <span class="st">"gray80"</span>) <span class="sc">+</span> </span>
<span id="cb30-7"><a href="#cb30-7"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"年齢 (歳)"</span>, <span class="at">y =</span> <span class="st">"投票に参加する確率の予測値"</span>) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>)) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="logit_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="1200"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/https:\/\/www\.jaysong\.net\/r4ps\//);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2023, <a href="https://www.jaysong.net" target="_blank">Jaehyun Song</a>. Powered by <a href="https://quarto.org/" target="_blank">Quarto</a></div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.jaysong.net">
      <i class="bi bi-house-fill" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/JaehyunSong">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>